<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Smart Film Scanner — IoT</title>
<link rel="manifest" href="manifest.webmanifest">
<style>
  body{font-family:system-ui,Arial;margin:14px;background:#f8fafc;color:#0f172a}
  .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,.06);margin-bottom:12px}
  video{width:100%;border-radius:10px;background:#000}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{padding:8px 12px;border-radius:10px;border:none;background:#334155;color:white;cursor:pointer}
  .btn.secondary{background:#e2e8f0;color:#0f172a}
  .muted{color:#64748b;font-size:13px}
  .pill{padding:6px 10px;border-radius:999px;color:white;font-weight:700}
  .ok{background:#10b981}.warn{background:#f59e0b}.bad{background:#ef4444}
  input, select { padding:8px; border-radius:8px; border:1px solid #e2e8f0; }
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:6px;border-bottom:1px solid #eef2f6;text-align:left}
</style>
</head>
<body>
<h2>Smart Film Scanner — Anthocyanin & Curcumin (IoT)</h2>

<div class="card">
  <div class="row" style="justify-content:space-between">
    <div>
      <label class="muted">Indicator chemistry</label><br/>
      <select id="chemistry">
        <option value="anthocyanin">Anthocyanin</option>
        <option value="curcumin">Curcumin</option>
      </select>
    </div>
    <div>
      <label class="muted">Mapping</label><br/>
      <select id="mapping">
        <option value="standard">Standard (unchanged)</option>
        <option value="inverse">Inverse</option>
      </select>
    </div>
    <div style="align-self:flex-end">
      <button id="start" class="btn">Start Camera</button>
      <button id="stop" class="btn secondary">Stop</button>
    </div>
  </div>
</div>

<div class="card">
  <video id="video" playsinline muted></video>
  <canvas id="canvas" style="display:none"></canvas>
  <div style="margin-top:8px">
    <label class="muted">ROI size</label><br/>
    <input id="roi" type="range" min="60" max="400" value="220"/>
  </div>
</div>

<div class="card">
  <div class="row" style="justify-content:space-between;align-items:center">
    <div>
      <div class="muted">Live RGB</div>
      <div id="rgb" style="font-weight:700">R 0 · G 0 · B 0</div>
    </div>
    <div id="swatch" style="width:56px;height:56px;border-radius:10px;border:1px solid #e2e8f0"></div>
    <div style="text-align:right">
      <div class="muted">Score (0-100)</div>
      <div id="score" style="font-weight:800;font-size:20px">0</div>
      <div id="status" class="pill ok" style="margin-top:6px">Fresh</div>
    </div>
  </div>

  <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
    <button id="save" class="btn">Save Sample</button>
    <button id="export" class="btn secondary">Export CSV</button>
    <button id="clear" class="btn secondary" style="background:#ffe4e6;color:#9f1239">Clear Data</button>
  </div>
</div>

<div class="card">
  <h3>MQTT IoT Settings</h3>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
    <div>
      <label class="muted">Broker (WS URL)</label><br/>
      <input id="mqttServer" placeholder="wss://broker.emqx.io:8084/mqtt" value="wss://broker.emqx.io:8084/mqtt">
    </div>
    <div>
      <label class="muted">Topic</label><br/>
      <input id="mqttTopic" placeholder="smartfilm/data" value="smartfilm/demo">
    </div>
    <div>
      <label class="muted">Client ID</label><br/>
      <input id="mqttClientId" placeholder="client-id" value="film-scanner-demo">
    </div>
    <div>
      <label class="muted">Username (optional)</label><br/>
      <input id="mqttUser" placeholder="(optional)">
    </div>
  </div>
  <div style="margin-top:10px;display:flex;gap:8px">
    <button id="btnConnect" class="btn">Connect MQTT</button>
    <button id="btnDisconnect" class="btn secondary">Disconnect</button>
    <div id="mqttStatus" class="muted" style="align-self:center">MQTT: disconnected</div>
  </div>
</div>

<div class="card">
  <h3>Saved Samples (last 5)</h3>
  <div style="overflow:auto;max-height:220px">
    <table id="samplesTable">
      <thead><tr><th>#</th><th>Time</th><th>Type</th><th>RGB</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer class="muted">Save sends samples to the MQTT broker if connected. Data is stored locally in your browser.</footer>

<!-- MQTT library -->
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="app.js"></script>
</body>
</html>
